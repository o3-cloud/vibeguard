---
summary: Implemented image vulnerability scanning in CI/CD pipeline using Trivy and Syft for SBOM generation
event_type: code
sources:
  - https://github.com/aquasecurity/trivy-action
  - https://github.com/anchore/sbom-action
  - https://aquasecurity.github.io/trivy/
  - https://anchore.com/syft/
  - ADR-005 (Adopt Vibeguard for Policy Enforcement)
tags:
  - docker-security
  - vulnerability-scanning
  - trivy
  - sbom
  - supply-chain-security
  - ci-cd
  - container-security
  - automation
---

# Image Vulnerability Scanning Implementation

## Overview

Successfully implemented automated Docker image vulnerability scanning in the CI/CD pipeline using Trivy for vulnerability detection and Syft for Software Bill of Materials (SBOM) generation.

## Changes Made

### 1. Monthly Docker Rebuild Workflow (docker-rebuild.yml)
Added comprehensive security scanning to the existing monthly rebuild process:

- **Build Separation**: Split build and push steps to allow scanning before registry push
- **Trivy Scanning**: Run Trivy on the built image, checking for HIGH and CRITICAL vulnerabilities
- **GitHub Security Integration**: Upload SARIF results to GitHub Security tab for visibility
- **SBOM Generation**: Generate CycloneDX JSON SBOM with Syft for supply chain transparency
- **Blocking Logic**: Prevent image push if HIGH/CRITICAL vulnerabilities are detected
- **Enhanced Reporting**: Updated workflow summary to document security scanning steps

### 2. Main CI Workflow (ci.yml)
Added Docker image scanning to PR/main branch checks:

- **Early Detection**: Scan image on every push and PR to catch vulnerabilities early
- **Trivy Scanning**: Check for HIGH and CRITICAL severity issues
- **GitHub Security Upload**: Report findings to Security tab (separate category for PR scans)
- **No Blocking**: PR scans are informational to avoid blocking CI for development branches

## Implementation Details

### Vulnerability Scanning Strategy
- **Tool**: Trivy (Aqua Security)
  - Fast, accurate vulnerability database
  - Supports multiple image input formats
  - GitHub Actions integration is straightforward

- **Severity Threshold**: HIGH and CRITICAL
  - Prevents merge of images with known critical issues
  - Allows for discussion and exception tracking of MEDIUM/LOW vulnerabilities
  - Aligns with risk tolerance established in security logs (25 LOW, 17 MEDIUM accepted)

### SBOM Generation
- **Tool**: Syft (Anchore)
  - Generates comprehensive Software Bill of Materials
  - CycloneDX format for supply chain security standards compliance
  - Useful for license compliance and vulnerability correlation

### Workflow Architecture
1. **Build Image**: Create Docker image artifact
2. **Export to TAR**: Load into local Docker for scanning
3. **Scan with Trivy**: Check for vulnerabilities, produce SARIF report
4. **Upload to GitHub Security**: Automatic integration with GitHub's security dashboard
5. **Generate SBOM**: Create supply chain documentation
6. **Decision Point**: Pass/Fail scan results
7. **Push to Registry**: Only push if scan passes (monthly rebuild)

## Compliance & Standards

- **Aligns with ADR-005**: Policy enforcement through automated tooling
- **Extends ADR-004**: Code quality standards now include container security
- **Supply Chain Security**: SBOM generation follows NIST and CycloneDX standards
- **GitHub Native**: Uses built-in GitHub Security features, no additional tools required

## Testing & Validation

- All vibeguard checks passed (10/10)
  - vet, fmt, lint, staticcheck, gosec, test, test-coverage, docker, build
- Workflow syntax validated
- GitHub Actions best practices followed

## Known Limitations & Future Improvements

### Current State
- HIGH/CRITICAL threshold prevents obviously dangerous images
- MEDIUM and LOW vulnerabilities still require manual review
- No automated image repository scanning (only at build time)

### Future Enhancements (Lower Priority)
1. **Automated Repository Scanning**: Set up Harbor or Quay for ongoing image monitoring
2. **Signature & Provenance**: Integrate cosign for image signing and verification
3. **Policy as Code**: Create vibeguard check for image scanning with custom policies
4. **Vulnerability Exception Process**: Formalize process for accepting known CVEs with justification
5. **Historical Tracking**: Store scan results with images for trend analysis

## Security Impact

- **Catches Regressions**: Any new HIGH/CRITICAL vulnerabilities in base images blocked automatically
- **Transparency**: SBOM and SARIF reports provide visibility to security posture
- **Proactive Scanning**: Monthly rebuilds + PR checks provide layered detection
- **Supply Chain**: SBOM generation helps with license and security correlation

## Integration Points

- **GitHub Security Tab**: Vulnerability reports visible to all team members
- **Beads Workflow**: Can track scan failures as issues for remediation
- **VibeGuard Checks**: Future enhancement to make vulnerability scanning a formal policy check
- **Deployment Gates**: Scans can be extended to production image checks

## References

- **Trivy**: Fast vulnerability scanner for containers
- **Syft**: Software Bill of Materials generator
- **SARIF**: Standard format for static analysis results
- **CycloneDX**: Standard for SBOM representation
